!--------------------------------------------------
!- Saturday, May 20, 2017 4:55:48 PM
!- Import of : 
!- c:\src\zelch64\bbs.prg
!- Commodore 64
!--------------------------------------------------
0 POKE650,128:CLR:CLOSE5:OPEN5,2,0,CHR$(6):SYS51977:GOTO100
1 IFM0=0THENPRINT#5,"at"+A$:GOSUB45:GET#5,A$,A$,A$,A$,A$,A$
2 POKE56579,32:POKE56577,0:RETURN
3 PRINT#8,"p"+CHR$(99)+CHR$(U1)+CHR$(U2)+CHR$(I):RETURN
4 GOSUB3:SYS38233:RETURN
5 IFTX$=""THENRETURN
6 SYS38209,TX$:GOTO8
7 SYS38206:IFPEEK(830)=1THEN1500
8 POKE710,0:POKE731,0:RETURN
9 IFP0<101THENP0$(P0)=E$:P0=P0+1:IFPEEK(709)THENPRINT#15,E$
10 RETURN
11 IN$="":SYS38200:IFPEEK(830)=1THEN1500
12 VY=PEEK(197):VZ=PEEK(653):IFVY>6ORVY<3THENRETURN
13 ON-(VY=5ANDVZ=1)-((VY=6ANDVZ=1)*2)-((VY=6ANDVZ=0)*3)GOTO16,17,18
14 IFVY<>5THENRETURN
15 PRINT:PRINT"ACS:"+STR$(AC):INPUT"NEW";AC:RETURN
16 I=255:GOSUB20:PRINT"BURST!":RETURN
17 TX$=CR$+"SYSOP LOCAL...":GOSUB5:PRINT"F1 ABORTS!":POKE720,1:RETURN
18 PRINT:PRINT"SUBOP ACS:";P(5):INPUT"NEW";P(5):RETURN
20 POKE897,I:POKE896,1:RETURN
21 IFOU$=""THENRETURN
22 POKE254,ASC(OU$):SYS38203:RETURN
25 IFNN=1THENTX$="{clear}space - abort/ cntrl[s] (home) - pause":GOSUB5
26 OU$=CR$:GOSUB21:IFVD<8THENVD=8
27 OPEN3,VD,VD,"0:"+FI$+",s,r":SYS38212:CLOSE3:IFPEEK(252)=0THEN29
28 TX$="hit return{ct c}":GOSUB5:GOSUB35
29 NN=0:VD=0:RETURN
30 I=0:GOSUB7:IFI$=""ORLEN(I$)>4THENRETURN
31 FORI8=1TOLEN(I$):IFMID$(I$,I8,1)="e"ANDVAL(LEFT$(I$,1))>0THENI$="0"
32 NEXTI8:IFVAL(I$)>0THENI=VAL(I$)
33 RETURN
35 GOSUB11:IFIN$<>CR$THEN35
36 OU$=CR$:GOSUB21:RETURN
37 POKE56579,32:POKE56577,0:IFM0=1THENRETURN
38 IFM0=2THENPOKE56577,32:POKE56579,0:RETURN
39 IF(PEEK(56577)AND16)=16THENRETURN
40 PRINT#5,CR$:GOSUB45:PRINT#5,"+++";:GOSUB45:PRINT#5,CR$+"ath":RETURN
41 T$=TI$
42 IFT$=TI$THEN42
43 RETURN
44 FORI=0TO9:POKE721+I,PEEK(43+I):NEXT:SYS51971:LOADI$,8
45 GOSUB41:GOSUB41:GOSUB41:RETURN
47 IFM0=2THENPOKE56579,38:POKE56577,0:RETURN
48 POKE56579,6:POKE56577,2:RETURN
49 RESTORE:FORI=659TO666:READA:POKEI,A:NEXT:BA=1200:GOTO52
50 DATA8,0,70,1,0,9,55,3,6,0,69,6,0,9,82,13,31,28,31,30,31,31,31,31,30,31,30,31
51 RESTORE:FORI=1TO8:READA:NEXT:FORI=659TO666:READA:POKEI,A:NEXT:BA=300
52 POKE51196,168:POKE51197,6:RETURN
55 EQ=0:CLOSE2:CLOSE3:CLOSE4:OPEN2,8,3,"0:{pound}log1":I=0:GOSUB3:GET#2,A$
56 INPUT#2,NA$,PH$,AC$,RN$,PS$:CLOSE2:OPEN2,8,3,"0:{pound}log2":I=0:GOSUB3:
57 INPUT#2,CA$,LC$:FORI=0TO9:INPUT#2,P(I):NEXT:CLOSE2:GOTO65
58 CLOSE2:CLOSE3:CLOSE4:OPEN2,8,3,"0:{pound}log1":A$="{pound}"+NA$+CR$+PH$+CR$+AC$+CR$+RN$
59 A$=A$+CR$+PS$:I=0:GOSUB3:PRINT#2,A$:CLOSE2:IFY0=0THENRETURN
60 IFY0=1THENY0=0:GOTO63
61 P(1)=INT(HN/256):P(0)=HN-(INT(HN/256)*256)
62 P(4)=INT(CC/256):P(3)=CC-(INT(CC/256)*256)
63 A$=CA$+CR$+LC$+CR$:FORI=0TO9:A$=A$+STR$(P(I))+CR$:NEXT:OPEN2,8,3,"0:{pound}log2"
64 I=0:GOSUB3:PRINT#2,A$:CLOSE2:RETURN
65 PP=P(0)+(256*P(1)):CC=P(3)+(256*P(4)):RETURN
66 GOSUB11:IFIN$=""THEN66
67 G=0:FORI8=1TOLEN(C$):IFIN$=MID$(C$,I8,1)THENG=I8
68 NEXTI8:IFG=0THEN66
69 TX$=IN$:GOSUB5:RETURN
100 GOSUB51:DIMTT$(101),Z1(50),Z2(50),P0$(100),DA(12),NA$(2,20),AC(2,20)
101 DIMDV(2,20),MM(2,20),V(20),I1$(10),I2$(10):RESTORE:CR$=CHR$(13):POKE53280,0
102 DA=PEEK(704):MN=PEEK(703):IFPEEK(788)>0THENSYS51980
110 FORI=1TO16:READA:NEXTI:FORI=1TO12:READA:DA(I)=A:NEXTI:IFPEEK(702)=16THEN200
130 PRINT"{clear}{down*5}{yellow}{ct n}DATA DISK(S) IN!":PRINT"PRESS {reverse on}RETURN{reverse off}";
140 GETA$:IFA$<>CHR$(13)THEN140
200 POKE702,0:OPEN3,8,8,"0:{pound}vars,s,r":INPUT#3,BN$:IFSTTHENCLOSE3:GOTO130
220 INPUT#3,MD,UL,UC,DC,M0,D0:FORI=0TO6:INPUT#3,C$(I),A$(I):NEXTI:FORI=0TO2
230 INPUT#3,N(I):FORX=0TON(I):INPUT#3,NA$(I,X),AC(I,X),DV(I,X),MM(I,X):NEXTX:NEXTI
240 FORI=0TO9:INPUT#3,CA(I),TM(I):NEXTI:FORI=1TO8:INPUT#3,A$:POKE684+I,ASC(A$)
250 NEXTI:CLOSE3:POKE701,M0:OPEN8,8,15:OPEN2,8,3,"0:{pound}log3":U1=1:U2=0
280 I=0:GOSUB4:I1$=I$:SYS38233:I2$=I$:INPUT#2,LZ,HN:CLOSE2:A$="x1e0m0v0":GOSUB1
285 CLOSE8:FORI=1TOD0:OPEN7+I,7+I,15,"i0":NEXT:IFPEEK(709)THENOPEN15,4,7
500 PRINT"{clear}{down*13}{cyan}";BN$:POKE682,0:POKE714,0
510 POKE53280,0:POKE53281,0:POKE896,0:POKE720,0:PRINT"{light blue}BBS mode:"
520 GOSUB37:PRINT"{blue}{reverse on}F1{reverse off} Local Menu":PRINT"{purple}{reverse on}F3{reverse off} Logon":PRINT"{red}Last Caller:";I1$
530 PRINT"{pink}Off At:";I2$:PRINT"{yellow}Calls Today:";STR$(PEEK(733))
550 SYS38215:PRINT"{home}{down}{right*2}{light gray}DATE:";MN;"/";DA;"   TIME:";I$;"{black}"
560 A=VAL(LEFT$(I$,2)):IF(PEEK(56577)AND8)=0ANDM0>0THENI=0:GOSUB47:GOTO650
570 IFRIGHT$(I$,2)="am"ANDPEEK(712)<>15THENIFA=1ORA=12THEN640
580 IFPEEK(712)=15ANDRIGHT$(I$,2)="am"ANDA<12ANDA>1THENPOKE712,0
590 GETA$:IFA$="{f1}"THEN800
600 IFA$="{f3}"THENPOKE714,1:POKE830,0:POKE720,1:GOTO1000
610 GET#5,B$:IFB$="5"ORB$=CHR$(181)THENPOKE830,0:POKE714,0:GOSUB49:GOTO1000
620 IFB$="1"ORB$=CHR$(177)THENPOKE830,0:POKE714,0:GOSUB51:GOTO1000
630 GOTO550
640 POKE712,15:PRINT"{clear}{down*3}{reverse on}{green}monster mode":I$="{pound}prg.monster":GOTO44
650 IF(PEEK(56577)AND16)=0THENB$="1":GOTO620
660 I=I+1:IFI<11THENFORA=0TO1000:NEXT:GOTO650
670 GOSUB37:GOTO550
800 PRINT"{clear}{pink}Z{yellow}e{white}l{cyan}c{light blue}h {light green}SysOp {green}Menu:":PRINT"{red}1) BBS mode":PRINT"{pink}2) Monster Mode"
810 PRINT"{yellow}3) Zap Term":PRINT"{white}4) Feedback":PRINT"{cyan}5) User Log":PRINT"{down}?:{reverse on} {reverse off}{left}";
820 POKE714,1:I=9:GOSUB20:POKE830,0:C$="12345":GOSUB66:POKE714,0
821 IFG=1THEN500
822 IFG=2THENDD=1:GOTO640
823 IFG=3THENI$="{pound}prg.term":GOTO44
824 IFG=4THENFI$="{pound}feedback":A=MD:GOTO900
825 IFG=5THENFI$="{pound}Log!":A=8:GOTO900
900 PRINT"{clear}":POKE720,1:OPEN3,A,8,"0:"+FI$+",s,r"
910 SYS38212:IFPEEK(253)=0THENCLOSE3:POKE720,0:PRINT:PRINT"{ct n}DELETE?";:GOTO950
920 PRINT"{ct n}Hit RETURN":
930 GETA$:IFA$<>CR$THEN930
940 GOTO910
950 GETA$:IFA$="y"THENPRINT"y":PRINT#A,"s0:"+FI$:GOTO500
960 IFA$<>"n"THEN950
970 PRINT"n":GOTO500
1000 CLOSE3:CLOSE4:FORI=0TO50:GET#5,A$:NEXT:POKE681,0:I=3:GOSUB20:PRINT"{light gray}";
1005 POKE682,1:TX$=CR$+CR$+CR$+"{white*3}connection!!!":GOSUB5:SYS38215:E$=I$+" call"
1010 GOSUB9:TX$=CR$+CR$+"hit return:{ct c}":GOSUB5
1015 GOSUB11
1020 IFIN$<>CR$ANDIN$<>CHR$(10)THEN1015
1025 IFPEEK(714)=1THENIN$="{f1}":GOTO1055
1030 NA$="":TX$=CR$+CR$+"commodore graphics":GOSUB5
1035 TX$="are the above words in uppercase?{ct c}":GOSUB5
1040 GOSUB11
1045 IFIN$="n"ORIN$="N"ORIN$=CHR$(110)THENTX$=IN$:GOSUB5:GOTO1060
1050 IFIN$<>"y"ANDIN$<>"Y"ANDIN$<>CHR$(121)THEN1040
1055 POKE681,1:TX$=IN$:GOSUB5:POKE682,0:GOTO1080
1060 TX$="NEED LINEFEEDS?{ct c}":GOSUB5:C$="yn":GOSUB66:IFG=2THENPOKE682,0:GOTO1080
1075 POKE682,1
1080 I=5:GOSUB20:NN=1:FI$="{pound}opening msg":IFPEEK(681)THENFI$=FI$+"/g"
1085 POKE762,79:POKE699,100:GOSUB25:A=0:CLOSE2:OPEN2,8,3,"0:{pound}log1"
1090 A=A+1:IFA=6THENTX$="{f1}GOODBYE!":GOSUB5:GOTO1500
1095 TX$="{f1}{ct n}?=USERLIST":GOSUB5:TX$="{f1}TYPE 'NEW' IF YOU HAVE NO ID #"
1100 NE=0:GOSUB5:TX$=CR$+"{f1}ENTER{sh space}YOUR ID NUMBER :{ct c}":GOSUB5:GOSUB30
1105 IFI$="?"THENFI$="{pound}members":GOSUB25:A=A-1:GOTO1090
1110 IFI=0ANDI$<>"new"THEN1090
1115 NA=I:IFI$="new"THENCLOSE2:I=10:GOSUB20:I$="{pound}prg.new1":GOTO44
1120 U2=INT(NA/256):U1=NA-(U2*256):I=0:GOSUB3:GET#2,A$:INPUT#8,E
1125 IFA$<>"{pound}"ORE>0THEN1140
1130 FORI=1TO5:SYS38233:NEXT:PS$=I$:TX$=CR$+"{f1}ENTER YOUR PASSWORD  :{ct c}":GOSUB5
1135 POKE710,1:GOSUB7:IFI$=PS$THENCLOSE2:GOTO1145
1140 TX$="{red}INVALID INFO!":GOSUB5:GOTO1090
1145 TX$="{clear}{f1}LOADING INFO...":GOSUB5:GOSUB55:AC=VAL(AC$):E$=NA$:GOSUB9
1150 I=TM(AC):GOSUB20:I$="{pound}prg.open":GOTO44
1500 CLOSE2:CLOSE3:CLOSE4:FORI=9TOD0+8:CLOSEI:NEXT:POKE682,0:POKE1,PEEK(1)OR2
1510 IFPEEK(830)=1THENTX$="{f1}time up!":GOSUB5
1520 CA$=STR$(VAL(CA$)+1):LC$=" 0":IFNA$=""THEN1600
1530 FI$="{pound}closing msg":GOSUB25:TX$="{red}{reverse on}BYE...":GOSUB5:GOSUB37:GOSUB60
1540 LC$=STR$(MN)+"/"+STR$(DA):PRINT"{white}{ct n}RESETTING!":OPEN3,8,8,"0:{pound}Log!,a"
1550 SYS38215:E$="off "+I$:GOSUB9:INPUT#8,E:IFE<20THEN1570
1560 CLOSE3:OPEN3,8,8,"0:{pound}Log!,s,w":PRINT#3,"start"
1570 PRINT#3,CHR$(1):PRINT#3,LC$:FORI=0TOP0-1:PRINT#3,P0$(I):P0$(I)="":NEXTI
1580 CLOSE3:OPEN2,8,3,"0:{pound}log3":U1=1:U2=0:I=0:GOSUB3:A$=NA$+"  "+CR$+LC$+" "
1590 A$=A$+I$+CR$+STR$(LZ+1)+CR$+STR$(HN):PRINT#2,A$:CLOSE2
1600 CLOSE8:GOSUB51:PRINT#5,CR$:PRINT#5,CR$:GOSUB37:POKE702,16:CLOSE5:RUN
2000 TX$=CR$+CR$+"{ct n}{f1}TIME LEFT={f1}"+STR$(PEEK(897))+"{f1}:(?):{f1}C{f1}O{f1}M{f1}M{f1}A{f1}N{f1}D{f1}:{ct c}"
2010 IFPEEK(681)=1THENTX$=TX$+"{f1}{left}> <{left*2}{ct c}"
2020 GOSUB5:C$="?"+C$(0)
2030 GOSUB66:IFG=1THENFI$="{pound}mainmenu"+STR$(AC):NN=1:GOSUB25:GOTO2000
2040 G=G-1:IFAC<VAL(MID$(A$(0),G,1))ORG<1THEN2000
2070 E$="cmd:"+IN$:GOSUB9:ONGGOTO2150,2200,2100,2250,2300,2400,2450,2500,2600,2800
2080 G=G-10:ONGGOTO2980,3000,3500,2990,2995,3800
2100 FI$="{pound}info":NN=1:GOSUB25:GOTO2000
2150 TX$="{f1}FEEDBACK(Y/N)?{ct c}":GOSUB5:GOSUB7:IFLEFT$(I$,1)<>"y"THEN2180
2160 FF$="{pound}feedback":QQ$="BY:"+NA$+" ID#"+STR$(NA):SYS38215
2170 QD$="ON:"+STR$(MN)+"/"+STR$(DA)+" AT:"+I$:V1=MD:GOSUB5000
2180 IFXX=0THEN2000
2190 GOTO1500
2200 TX$="{f1}OFF(Y/N)?{ct c}":GOSUB5:GOSUB7:IFLEFT$(I$,1)="y"THENXX=1:GOTO2150
2210 GOTO2000
2250 IF(PEEK(53280)AND15)=1THENTX$=CR$+"{f1}THE{sh space}PAGE{sh space}LIGHT{sh space}IS{sh space}ON!":GOSUB5:GOTO2000
2255 TX$="{f1}PAGING SYSOP...{ct c}":GOSUB5:POKE53280,1:FORX=1TO25:FORI=1TO50:NEXTI
2260 TX$="{f1}.{ct g}{ct c}":GOSUB5:NEXTX:GOTO2000
2270 IFPEEK(682)=0THEN2000
2280 POKE682,0:RETURN
2300 TX$=CR$+"{f1}USERLIST(?):{ct c}":GOSUB5:POKE731,1:GOSUB30:IFI$="?"THEN2340
2302 IFI>0ORI$=""THEN2345
2304 OPEN3,8,8,"0:{pound}members,s,r":A$=I$:A=0:SYS38230:SYS38209,I$
2306 SYS38230:IFI$=""THEN2399
2308 B$=RIGHT$(LEFT$(I$,LEN(I$)-1),LEN(I$)-LEN(STR$(A))-4)
2310 IFMID$(B$,1,LEN(A$))=A$THENTX$=I$:GOSUB5
2320 A=A+1:GOSUB11:IFIN$=" "THEN2399
2330 GOTO2306
2340 TX$="{f1}ENTER ID#"+CR$+"{f1}SEARCH LETTERS"+CR$+"{f1}OR (RETURN){down}":GOSUB5:GOTO2300
2345 OPEN3,8,8,"0:{pound}members,s,r":SYS38230:SYS38209,I$
2350 SYS38230:IFI$=""THEN2399
2355 X=VAL(RIGHT$(I$,LEN(I$)-1)):IFX<ITHEN2350
2360 SYS38209,I$:GOSUB11:IFIN$=" "THEN2399
2370 SYS38230:IFI$=""THEN2399
2380 GOTO2360
2399 CLOSE3:GOTO2270
2400 A$=CR$+"{f1}--------------------"+CR$:TX$=A$+"{f1}STATUS ":GOSUB5:SYS38215
2410 TX$="{f1}HANDLE:"+NA$+CR$+"{f1}REAL NAME:"+RN$+CR$+"{f1}ACCESS:"+AC$+CR$+"{f1}TIME:"+I$
2415 GOSUB5:TX$="{f1}U/D CREDITS:"+STR$(CC):GOSUB5
2420 I$=STR$(TM(AC)-PEEK(897)):TX$="{f1}ONLINE:"+I$+CR$+A$:GOSUB5:GOTO2000
2450 TX$="{clear}{down*2}{f1}EMAIL SECTION!":GOSUB5:I$="{pound}prg.email":GOTO44
2455 NN=-1:GOTO2465
2460 TX$=CR$+"{ct n}{f1}EMAIL:{ct c}":GOSUB5:NN=0
2462 C$=C$(4)+"?":GOSUB66:WH=0:E$="eml:"+IN$:GOSUB9:ONGGOTO8500,2470,8010,2000
2465 FI$="{pound}emailmenu":NN=NN+1:GOSUB25:GOTO2460
2470 POKE682,1:GOSUB2300:GOTO2460
2500 TX$=CR$+"{f1}SYSOP:{ct c}":GOSUB5:C$=C$(3)+"?":GOSUB66:E$="sys:"+IN$:GOSUB9
2501 IFG=1THENDV=8
2502 IFG=2THENPOKE682,1:GOSUB2300:GOTO2500
2503 IFG=3THENI$="{pound}prg.user1":GOTO44
2504 IFG=4THENI$="{pound}prg.user2":GOTO44
2505 IFG=5THENTX$="{f1}RELOADING...":GOSUB5:GOSUB55:GOTO2500
2506 IFG=6THENYY=0:I$="{pound}prg.mtedit":GOTO44
2507 IFG=7THENYY=1:I$="{pound}prg.mtedit":GOTO44
2508 IFG=8THENI$="{pound}prg.vedit":GOTO44
2509 IFG=9THEN2000
2510 IFG=10THENFI$="{pound}sysopmenu":NN=1:GOSUB25:GOTO2500
2520 TX$=CR$+STR$(DV)+":{ct c}":GOSUB5:GOSUB7:IFI$=""THEN2500
2522 A$=LEFT$(I$,1):IFA$="@"ANDLEN(I$)>2THENA$=RIGHT$(I$,LEN(I$)-2):GOTO2540
2524 IFA$="w"ANDLEN(I$)>2THENFF$=RIGHT$(I$,LEN(I$)-2):GOTO2550
2526 IFA$="e"ANDLEN(I$)>2THENFF$=RIGHT$(I$,LEN(I$)-2):GOTO2555
2528 IFA$="@"THENI$="":GOTO2536
2530 IFA$="$"THENPOKE253,0:OPEN3,DV,0,I$:SYS38224:CLOSE3:GOTO2520
2532 IFA$="%"THEN2590
2534 IFLEN(I$)<4ANDVAL(I$)>7ANDVAL(I$)<12THENDV=VAL(I$):GOTO2520
2535 PRINT#DV,I$
2536 INPUT#DV,E1,E1$,E2,E3:TX$=STR$(E1)+","+E1$+","+STR$(E2)+","+STR$(E3)
2538 GOSUB5:GOTO2520
2540 OPEN3,DV,DV,"0:"+A$+",s,r"
2542 SYS38212:IFPEEK(253)=0THENCLOSE3:GOTO2520
2544 TX$="{white}{ct n}S)KIP NEXT OR (RETURN){ct c}":GOSUB5:GOSUB7:IFI$<>"s"THEN2542
2546 SYS38218:GOTO2544
2550 QQ$="":QD$="":S0=1:V1=DV:GOSUB5000:GOTO2520
2555 TX$="{f1}SEARCHING FOR "+FF$:GOSUB5:OPEN3,DV,DV,"0:"+FF$+",s,r":GET#3,A$:UP=0
2560 IFST>0THENTX$="FILE{sh space}NOT{sh space}FOUND":GOSUB5:GOTO2587
2565 TX$="LOADING":GOSUB5
2570 QQ$="":CLOSE3:OPEN3,DV,DV,"0:"+FF$+",s,r":LN=0:FORI=0TO100:TT$(I)="{black}":NEXTI
2575 SYS38230:IFPEEK(253)=1THEN2586
2580 IFI$=CHR$(142)+CHR$(147)THENUP=1:SYS38209,I$:GOTO2575
2585 SYS38209,I$:TT$(LN)=I$:LN=LN+1:GOTO2575
2586 CLOSE3:SYS38209,I$:A=FRE(0):TT$(LN)=I$:LN=LN+1:S3=1:GOTO2550
2587 CLOSE3:GOTO2520
2590 I$=RIGHT$(I$,LEN(I$)-1):OPEN3,DV,0,"$"+I$:SYS38242:CLOSE3
2595 TX$=STR$(PEEK(706))+" files counted":GOSUB5:GOTO2520
2600 CS=0:TX$="{clear}{f1}{down}SIG SYSTEM!{white}":GOSUB5:I$="{pound}prg.read":GOTO44
2605 GOSUB2610:GOTO2650
2610 TX$=CR$+"{f1}{down}ENTERING SIG "+CHR$(97+CS):GOSUB5:DV=DV(0,CS):CM=0:I1=0:I2=0
2611 VD=DV:FI$="{pound}sigmsg "+CHR$(65+CS):GOSUB25:OPEN2,8,3,"0:{pound}Sig "+CHR$(97+CS)
2612 J0=0:FORI=1TONM:Z1(I)=0:NEXT:A=U1:B=U2:U1=1:U2=0:I=0:GOSUB3:INPUT#2,NM,MP
2613 FORU1=2TONM+1:X=U1-1:I=0:GOSUB3:INPUT#2,Z1(X),Z2(X)
2614 I1=I1+Z1(X):IFZ2(X)>PPTHENJ0=J0+1
2615 NEXTU1:CLOSE2:TX$=CR$+"{f1}"+STR$(NM)+" MESSAGE(S) /"+STR$(I1)+" REPLY(S)"
2616 U1=A:U2=B:GOSUB5:TX$="{f1}"+STR$(J0)+" NEW MESSAGE(S) / REPLY(S)":GOSUB5:RETURN
2620 OPEN2,8,3,"0:{pound}Sig "+CHR$(97+CS):A=U1:B=U2:U1=1:U2=0:I=0:GOSUB3
2625 PRINT#2,STR$(NM)+CR$+STR$(MP):U1=M+1:GOSUB3:PRINT#2,STR$(X)+CR$+STR$(Y)
2630 CLOSE2:U1=A:U2=B:RETURN
2650 IFWI=1THENCM=CM+1:GOTO2686
2651 IFKD=1THEN2770
2655 TX$=CR$+"{ct n}{f1}SIG {f1}"+CHR$(97+CS)+"{white}:{ct c}":GOSUB5:C$="?"+CR$+C$(2):GOSUB66
2656 G=G-2:E$="msg:"+IN$:GOSUB9:IFG<1THEN2668
2657 IFASC(IN$)>192THEN2690
2658 IFASC(IN$)>96THEN2689
2659 IFAC<VAL(MID$(A$(2),G,1))THEN2650
2660 ONGGOTO2670,8010,2675,2685,2000,2700,2695,2750
2668 IFG=0THEN2780
2669 FI$="{pound}msgmenu":NN=1:GOSUB25:GOTO2655
2670 TX$="{f1}SIGS: ":GOSUB5:FORI=0TON(0):IFAC(0,I)>ACTHEN2674
2673 TX$="{f1}("+CHR$(I+193)+") "+NA$(0,I):GOSUB5
2674 NEXTI:GOTO2650
2675 I=1:IFI>NMTHEN2650
2676 OPEN3,DV,DV,"0:{pound}msg "+CHR$(65+CS)+STR$(I):SYS38227
2677 IFLEN(I$)<3THEN2679
2678 I$=RIGHT$(I$,LEN(I$)-2):I$="{f1}"+I$
2679 CLOSE3:TX$="MSG #"+STR$(I)+"/{f1}"+STR$(Z1(I))+" REPLYS"+CR$+I$:GOSUB5
2680 GOSUB11:IFIN$=" "THEN2650
2681 I=I+1:IFI>NMORI<1THEN2650
2684 GOTO2676
2685 CM=1:WI=0:TX$="{f1}READ NEW...":GOSUB5
2686 IFCM>NMTHENWI=0:GOTO2650
2687 G=3:IFZ2(CM)>PPTHENWI=1:GOTO8050
2688 CM=CM+1:GOTO2686
2689 IN$=CHR$(ASC(IN$)+96)
2690 I=ASC(IN$)-193:IFI>N(0)ORI=CSTHEN2650
2691 IFAC(0,I)>ACTHEN2650
2693 CS=I:GOSUB2610:GOTO2650
2695 IFP(5)<>CS+1ANDP(5)<>100THEN2650
2696 I$="{pound}prg.medit":GOTO44
2700 V1=DV:TX$="{f1}POST A MESSAGE(Y/N)?{ct c}":GOSUB5:C$="yn":GOSUB66:IFG=2THEN2650
2715 QQ$="{clear}{f1}POSTED BY:"+NA$+"{reverse off}{f1} ID#"+STR$(NA)+CR$
2720 TX$=CR$+"{f1}SUBJECT:{ct c}":GOSUB5:GOSUB7:A$=I$:IFI$=""THENA$="NONE"
2725 SYS38215:QQ$=QQ$+"{f1}ON:"+STR$(MN)+"/"+STR$(DA)+"  {f1}TIME:"+I$
2730 QD$="{f1}SUBJECT:"+A$+CR$:IFMM(0,CS)>NMTHENNM=NM+1
2732 D=MP:S0=1:MP=MP+1:IFMP>MM(0,CS)THENMP=1
2734 FF$="{pound}msg "+CHR$(CS+65)+STR$(MP):GOSUB5000:IFS2=1THENNM=NM-1:MP=D:GOTO2650
2735 CC=CC+UC:M=MP:HN=HN+1:Z1(M)=0:Z2(M)=HN:X=Z1(M):Y=Z2(M):GOSUB2620
2737 GOTO2650
2750 TX$="{f1}ALL{sh space}NEW...":GOSUB5:KD=0
2755 IFJ0>0THENG=3:KD=1:GOTO2685
2760 GOTO2770
2765 GOSUB2610:IFJ0>0THENG=3:KD=1:GOTO2685
2770 CS=CS+1:IFCS>N(0)THEN2778
2773 IFAC(0,CS)<=ACTHEN2765
2778 TX$="DONE!":GOSUB5:CS=CS-1:KD=0:GOTO2650
2780 CM=CM+1:GOTO8050
2790 TX$="{f1}NUMBER{sh space}TO{sh space}SKIP:{ct c}":GOSUB5:GOSUB30:I9=I:IFI9>Z1(CM)THEN8280
2795 GOTO8170
2800 TX$="{clear}{down}{f1}UPLOAD/DOWNLOAD SYSTEM!":GOSUB5:I$="{pound}prg.udsec":GOTO44
2805 FI$="{pound}udmenu":GOSUB25:GOTO2810
2808 GOSUB45:GOSUB41
2810 CLOSE2:YU=0:TX$=CR$+"{down}{f1}U{white}/{f1}D{white} "+CHR$(CU+193)+":{ct c}":GOSUB5
2811 C$="?"+CR$+C$(6):GOSUB66:E$="u/d:"+IN$:GOSUB9:G=G-2:IFG<1THEN2818
2812 IFASC(IN$)>192THEN8300
2813 IFASC(IN$)>96THEN8299
2816 IFAC>=VAL(MID$(A$(6),G,1))THENONGGOTO8100,2000,9000,9500,8200
2818 IFG<0THENFI$="{pound}udmenu":NN=1:GOSUB25
2819 GOTO2810
2830 TX$="{clear}{down}{f1}GO{sh space}TO{sh space}SEND{sh space}FILES MODE!":GOSUB5:FI$=FI$+"w":QY=1:GOTO2849
2832 SYS49173:SYS49161:E$="ul:"+FI$:GOSUB9:IFPEEK(512)=1THEN2860
2836 OPEN2,DV(2,CU),8,"0:"+FI$:INPUT#2,DV(2,CU),E:IFE>0THEN2860
2838 FORI=1TO1300:NEXTI:SYS61310:SYS49173:SYS49155:FORX=1TO150:NEXTX
2840 POKE668,PEEK(667):SYS49173:YU=1:GOTO2860
2849 TX$="{f1}(A) TO{sh space}ABORT{sh space}BEFORE TRANSFER.":GOSUB5:TI$="000000"
2850 ER=0:GOSUB11:IFIN$="a"ORIN$="A"ORVAL(TI$)>40THENER=1:GOTO2860
2856 GET#5,A$:IFA$<>"g"ANDA$<>"o"ANDA$<>"k"THEN2850
2858 IFQY=1THENQY=0:GOTO2832
2859 GOTO2940
2860 TX$="{clear}":GOSUB5:QY=0:CLOSE2:IFYU=0ORFH=1THEN2870
2862 OPEN3,DV(2,CU),0,"$0:z=u":SYS38245:CLOSE3
2863 IFPEEK(707)>MM(2,CU)ORPEEK(708)>0THEN2870
2866 PRINT#DV(2,CU),"s0:"+FI$:PRINT#DV(2,CU),"v"
2870 IFFH=1THENFH=0:GOTO9000
2880 IFER=1THEN2808
2885 OPEN3,DV(2,CU),0,"$0:"+FI$:SYS38239:CLOSE3:A=PEEK(251)
2887 IFYU=0THENCC=CC-(A*DC)
2890 IFYU=1THENYU=0:CC=CC+(A*UC)
2895 GOTO2808
2930 TX$="{clear}{down}{f1}GO TO RECEIVE FILES MODE!":GOSUB5:QY=0:GOTO2849
2940 POKE51227,TY:SYS49173:SYS49164:IFPEEK(512)=1THEN2860
2950 E$="dl:"+FI$:GOSUB9:SYS49173:POKE51224,255:SYS49158
2955 GOTO2860
2980 I$="{pound}prg.vote":GOTO44
2990 I$="{pound}prg.var":GOTO44
2995 I$="{pound}prg.menu":GOTO44
3000 IFPEEK(659)=8THENTX$="{f1}CANNOT{sh space}CHANGE{sh space}1200 BAUD":GOSUB5:GOTO2000
3010 TX$="{f1}BAUD{sh space}IS"+STR$(BA):GOSUB5:TX$="{f1}NEW BAUD (RETURN):{ct c}":GOSUB5
3020 GOSUB30:IFI<200ORI>500THEN2000
3030 TX$="{f1}CHANGE BAUD NOW! (RETURN){ct c}":GOSUB5:POKE659,6
3040 BA=I:A=1022730/BA/2:GOSUB3499:POKE51196,X:POKE51197,Y:A=1022730/BA
3050 GOSUB3499:POKE665,X:POKE666,Y:A=1022730/BA/2-100:GOSUB3499:POKE661,X
3060 POKE662,Y:POKE659,6
3070 IFFH=1THENFH=0:RETURN
3090 GOSUB35:GOTO2000
3499 Y=INT(A/256):X=A-(Y*256):RETURN
3500 I$="{pound}prg.text":GOTO44
3800 TX$="{f1}SURE YOU{sh space}WANT TO{sh space}TOGGLE "+CR$+"C= GFX/ASCII (Y/N)?{ct c}":GOSUB5
3801 C$="yn":GOSUB66:IFG=2THEN2000
3804 TX$=CR$+"{f1}SWITCH TO ":IFPEEK(681)THENTX$=TX$+"ASCII AND{sh space}HIT{sh space}RETURN{ct c}"
3805 IFPEEK(681)=0THENTX$=TX$+"C= COLOR/GFX AND{sh space}HIT RETURN{ct c}":
3810 GOSUB5:POKE681,ABS(PEEK(681)-1):GOSUB35:GOTO2000
5000 UP=0:OU$="{ct n}":IFUP=1ORP(6)AND8THENOU$=CHR$(142):UP=1
5001 POKE705,0:IFP(6)AND4THENPOKE705,1
5002 LO=0:POKE762,CX:IFP(6)AND2THENLO=1:POKE762,CX-3
5003 ML=100:IFP(6)AND1THENML=50
5010 IFS3=0THENFORI=0TO100:TT$(I)="{black}":NEXTI:LN=0
5020 GOSUB21:A=FRE(0):IFS1=1THEN5040
5030 TX$="{clear}{f1}message maker!":GOSUB5
5040 TX$="{f1}type /h for help":GOSUB5:S1=0:S2=0:S3=0
5050 TX$="{f1}"+RIGHT$(STR$(ML),LEN(STR$(ML))-1)+" lines max. go!{white}":GOSUB5
5060 IFLO=1THENI5=LN:GOSUB5360
5070 GOSUB7:IFI$=""THENI$="{black}"
5080 TT$(LN)=I$:K$="":Q$=LEFT$(TT$(LN),2):IFLEFT$(Q$,1)="/"THENK$=RIGHT$(Q$,1)
5090 IFK$=""THEN5130
5100 G=0:FORI=1TOLEN(C$(1)):IFK$=MID$(C$(1),I,1)THENG=I
5110 NEXTI:IFG=0THEN5130
5120 ONGGOTO5145,5150,5250,5370,5380,5390,5395,5400,5410,5430,5440,5450,5470
5130 IFLN>ML-1THENTX$="max lines exceeded. type /h for help":GOSUB5:GOTO5060
5140 LN=LN+1:GOTO5060
5145 FI$="{pound}msgmkr help":GOSUB25:GOTO5060
5150 TX$="save..(y/n){ct c}":GOSUB5:C$="yn":GOSUB66:IFG=2THEN5060
5180 TX$="saving...":GOSUB5:IFS0=1THENPRINT#V1,"s0:"+FF$
5190 OPEN3,V1,V1,"0:"+FF$+",a":INPUT#V1,E
5200 IFE<20THENPRINT#3,CHR$(1):GOTO5220
5210 CLOSE3:OPEN3,V1,V1,"0:"+FF$+",s,w"
5220 IFQQ$<>""ANDQD$<>""THENPRINT#3,QQ$:PRINT#3,QD$+"{white}":PRINT#3,CHR$(2)
5230 TT$(LN)=CHR$(144):IFUP=1THENPRINT#3,CHR$(142)+"{clear}"
5240 FORI=0TOLN-1:PRINT#3,TT$(I):NEXTI:CLOSE3:TX$="saved":GOSUB5:GOTO5420
5250 GOSUB5350:IFER=1THEN5060
5260 SYS38209,TT$(Q):TX$="e)dit or r)ewrite?{ct c}":GOSUB5:C$="er"+CR$:GOSUB66
5280 IFG=1THEN5300
5285 IFG=3THEN5060
5290 TX$="rewrite line"+STR$(Q):GOSUB5:IFLO=1THENI5=Q:GOSUB5360
5291 GOSUB7:IFI$=""THENTX$="no change":GOSUB5:GOTO5060
5295 TT$(Q)=I$:GOTO5060
5300 X=1:TX$="change from:{ct c}":GOSUB5:GOSUB7:I3=LEN(I$):I4=LEN(TT$(Q))
5305 IFI$=""THEN5060
5310 IFMID$(TT$(Q),X,I3)=I$THEN5340
5320 X=X+1:IFX<=I4THEN5310
5330 TX$="not found!":GOSUB5:GOTO5060
5340 I1=X-1:I2=I4-X-I3+1:I1$=LEFT$(TT$(Q),I1):I2$=RIGHT$(TT$(Q),I2)
5345 TX$="to:{ct c}":GOSUB5:GOSUB7:TT$(Q)=I1$+I$+I2$:IFTT$(Q)=""THENTT$(Q)="{black}"
5347 GOTO5060
5350 Q=0:ER=0:E$=RIGHT$(TT$(LN),LEN(TT$(LN))-2):IFLEN(E$)>2THENER=1:GOTO5359
5355 Q=VAL(E$):IFQ>LN-1ORQ<0THENTX$="bad line #":GOSUB5:ER=1
5359 RETURN
5360 TX$=STR$(I5):IFI5<10THEN5365
5362 TX$=RIGHT$(TX$,LEN(TX$)-1)
5365 TX$=TX$+">{ct c}":GOSUB5:RETURN
5370 TX$="from ( 0-"+STR$(LN-1)+"){ct c}":GOSUB5:GOSUB30:I1=I:IFI1>LN-1ORI$=""THEN5060
5372 TX$="to ("+STR$(I1)+"-"+STR$(LN-1)+"){ct c}":GOSUB5:GOSUB30
5374 I2=I:IFI2>LN-1ORI2<I1ORI$=""THEN5060
5376 I3=I2-I1+1:FORI=I1TOLN-I3+1:TT$(I)=TT$(I+I3):NEXTI:LN=LN-I3:IFLN<0THENLN=0
5378 A=FRE(0):GOTO5060
5380 GOSUB5350:IFER=1THEN5060
5382 TX$=STR$(Q)+">"+TT$(Q)+CHR$(0):TX$=RIGHT$(TX$,LEN(TX$)-1):GOSUB5
5384 GOSUB11:IFIN$=" "THEN5060
5386 Q=Q+1:IFQ<=LN-1THEN5382
5388 GOTO5060
5390 TX$="clear..(y/n){ct c}":GOSUB5:C$="yn":GOSUB66:ONGGOTO5000,5060
5395 GOSUB5350:IFER=1THEN5060
5396 TX$=TT$(Q):GOSUB5:GOSUB11:IFIN$=" "THEN5060
5397 Q=Q+1:IFQ<=LN-1THEN5396
5398 GOTO5060
5400 GOSUB5350:IFER=1ORLN>ML-1THEN5060
5404 FORI=LNTOQ+1STEP-1:TT$(I)=TT$(I-1):NEXTI:TT$(Q)="{black}":LN=LN+1:GOTO5378
5410 TX$="abort..(y/n){ct c}":GOSUB5:C$="yn":GOSUB66:IFG=2THEN5060
5415 S2=1
5420 QQ$="":QD$="":UP=0:S0=0:S1=0:S3=0:LO=0:POKE762,CX:
5425 FORI=0TO100:TT$(I)="":NEXTI:A=FRE(0):OU$="{ct n}":GOSUB21:RETURN
5430 IFPEEK(681)=1ANDUP=0THENUP=1:OU$=CHR$(142):GOSUB21:GOTO5060
5435 UP=0:OU$="{ct n}":GOSUB21:GOTO5060
5440 IFPEEK(705)=1THENPOKE705,0:TX$="w/w off":GOSUB5:GOTO5060
5445 POKE705,1:TX$="w/w on":GOSUB5:GOTO5060
5450 TX$=CR$+"centering...":GOSUB5:FORQ=0TOLN:IFTT$(Q)="{black}"THEN5469
5455 Y=0:I$=TT$(Q):FORI=1TOLEN(I$):IFMID$(I$,I,1)<>" "ANDY=0THENY=I
5460 NEXTI:I$=RIGHT$(I$,LEN(I$)-(Y-1)):I=LEN(I$):FORX=0TO((((CX+1)/2)-(I/2))-1)
5465 I$=" "+I$:NEXTX:TT$(Q)=I$
5469 NEXTQ:TX$="centered.":GOSUB5:GOTO5060
5470 IFLO=0THENLO=1:TX$="l/n on":GOSUB5:POKE762,CX-3:GOTO5060
5480 TX$="l/n off":GOSUB5:POKE762,CX:LO=0:GOTO5060
7999 PRINT"{ct z}{ct x}{ct c}"
